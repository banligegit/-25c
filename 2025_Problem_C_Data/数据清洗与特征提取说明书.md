# 奥运奖牌榜模型 - 数据清洗与特征提取详细说明

## 一、数据清洗概览

本项目对原始数据进行了全面的清洗，主要包括以下步骤：

### 1.1 国家代码标准化与合并

#### 删除的国家（共17个）
以下国家因政治变迁、国际制裁或历史原因而在后续分析中被删除：
- **AHO**: 荷属安的列斯（2010年解体）
- **BLR**: 白俄罗斯（国际奥委会制裁）
- **BOH**: 波希米亚（奥匈帝国的一部分，1920年后成为捷克斯洛伐克）
- **CRT**: 克里特（希腊的一部分）
- **EUN**: 独联体联合队（仅在1992年出现过一次）
- **IOA**: 独立奥运选手队（特殊情况，2024年无此队伍）
- **LIB, MAL, NBO, NFL, RHO**: 历史国家（政治变迁或并入其他国家）
- **ROC, RUS**: 俄罗斯（国际奥委会制裁，无法以国家名义参赛）
- **UNK**: 未知队伍（非正式）
- **URS**: 苏联（1991年解体）
- **WIF**: 西印度群岛联邦（解散）
- **YUG**: 南斯拉夫（解体）

#### 国家代码映射与合并
| 原代码 | 新代码 | 合并规则 |
|--------|--------|--------|
| ANZ | AUS, NZL | 澳大拉西亚（1908、1912）数据均分 |
| SAA | YEM | 南阿拉伯联邦→也门 |
| VNM | VIE | 越南代码更新 |
| YAR, YMD | YEM | 北也门、南也门→也门（1990年后） |
| FRG, GDR | GER | 西德、东德→德国（1990年后） |
| SCG | SRB, MNE | 塞尔维亚和黑山（2006年解体，保留历史数据） |
| TCH | CZE, SVK | 捷克斯洛伐克（1993年解体，保留历史数据） |
| UAR | EGY, SYR | 阿拉伯联合共和国（保留历史数据） |

### 1.2 团体项目去重

**关键问题**：在篮球、足球、接力等团体项目中，每个队员都有一条记录，但在奖牌榜中该项目只算一次奖牌。

**解决方案**：
```
对 (Year, NOC, Event, Medal) 的组合进行去重
- 删除了 125,813 条重复的团体项目记录
- 运动员原始数据：252,566 条 → 清洗后：113,342 条
- 奖牌统计数据：1,437 条 → 清洗后：1,434 条
```

### 1.3 编码问题修复

- 使用 `encoding='utf-8-sig'` 处理BOM（字节顺序标记）问题
- 修复了运动员和奖牌数据中的编码不兼容问题

---

## 二、特征提取详述

最终构建的特征数据集包含 **8,618 条记录**（278个国家 × 31个年份），共 **22个特征列**。

### 2.1 目标变量 (Target Variables)

| 特征名 | 含义 | 数据类型 | 备注 |
|--------|------|--------|------|
| `Gold_Medals` | 某年某国的金牌数 | int | 预测目标（主要） |
| `Silver_Medals` | 某年某国的银牌数 | int |  |
| `Bronze_Medals` | 某年某国的铜牌数 | int |  |
| `Total_Medals` | 某年某国的总奖牌数 | int | 预测目标（次要） |

**示例**：
- 2024年中国：40枚金牌，91枚总奖牌
- 2024年美国：40枚金牌，126枚总奖牌
- 2024年法国：16枚金牌，64枚总奖牌

### 2.2 历史特征 (Lag Features)

利用奥运会的4年周期特性，提取过去届次的奖牌数据：

| 特征名 | 含义 | 计算方式 |
|--------|------|--------|
| `Lag_1_Gold` | 上一届金牌数 | shift(1) by NOC |
| `Lag_2_Gold` | 上上届金牌数 | shift(2) by NOC |
| `Lag_3_Gold` | 上上上届金牌数 | shift(3) by NOC |
| `Lag_1_Total` | 上一届总奖牌数 | shift(1) by NOC |
| `Lag_2_Total` | 上上届总奖牌数 | shift(2) by NOC |
| `Lag_3_Total` | 上上上届总奖牌数 | shift(3) by NOC |
| `Avg_3yr_Gold` | 过去3届平均金牌数 | rolling mean(3) |
| `Avg_3yr_Total` | 过去3届平均总奖牌数 | rolling mean(3) |

**作用**：
- 强大的时间序列预测因子
- 捕捉国家的竞争力趋势
- 处理缺失值（首次参赛的国家会有NaN）

### 2.3 东道主效应特征 (Host Effect)

| 特征名 | 含义 | 取值 | 备注 |
|--------|------|------|------|
| `Is_Host` | 是否为主办国 | 0/1 | 经验上主办国平均增加10-15%奖牌数 |

**已识别的主办国** (共29个)：
```
1896-1900-1904-1908-1912 (雅典-巴黎-圣路易斯-伦敦-斯德哥尔摩)
1920-1924-1928-1932-1936 (安特卫普-巴黎-阿姆斯特丹-洛杉矶-柏林)
1948-1952-1956-1960-1964 (伦敦-赫尔辛基-墨尔本-罗马-东京)
1968-1972-1976-1980-1984 (墨西哥城-慕尼黑-蒙特利尔-莫斯科-洛杉矶)
1988-1992-1996-2000-2004 (汉城-巴塞罗那-亚特兰大-悉尼-雅典)
2008-2012-2016-2020-2024 (北京-伦敦-里约-东京-巴黎)
```

### 2.4 运动员投入特征 (Athlete Power)

| 特征名 | 含义 | 计算方式 | 范围 |
|--------|------|--------|------|
| `Athlete_Count` | 派出的运动员总数 | groupby().count() | 0-321 |
| `Female_Athletes` | 女性运动员数 | groupby().sum(Sex=='F') | 0-160 |
| `Female_Ratio` | 女性比例 | Female_Athletes / Athlete_Count | 0.0-1.0 |

**作用**：
- `Athlete_Count` 是除GDP外最强的国力代理变量
- 与奖牌数的相关性 > 0.8（强正相关）
- 反映国家的经济能力和运动员资源

**示例（2024年）**：
- 中国：258名运动员，女性比例 44%
- 美国：319名运动员，女性比例 45%
- 日本：164名运动员，女性比例 48%

### 2.5 项目覆盖度特征 (Sport Coverage)

| 特征名 | 含义 | 计算方式 | 范围 |
|--------|------|--------|------|
| `Sport_Count` | 参赛的运动大类数 | nunique(Sport) | 0-32 |
| `Event_Count` | 参赛的具体项目数 | nunique(Event) | 0-339 |
| `Total_Gold_in_Olympics` | 当年奥运会总金牌数 | sum(Gold) by Year | 43-130 |

**作用**：
- 反映国家的参赛广度
- `Total_Gold_in_Olympics` 随着时间增加而增长（新项目增加）
- 国家的参赛项目组合决定了潜在奖牌数

### 2.6 项目效率特征 (Sport Efficiency - 用于教练效应分析)

| 特征名 | 含义 | 计算方式 |
|--------|------|--------|
| `Avg_Sport_Efficiency` | 平均项目效率 | 奖牌数 / 参赛人数 (按项目平均) |

**计算过程**：
1. 计算每个国家每项运动的效率：$E_{sport} = \frac{\text{Medals in Sport}}{\text{Athletes in Sport}}$
2. 取该国该年所有运动的平均效率

**用途**：
- 检测"伟大教练"效应（效率突然提升）
- 识别项目专业化程度
- 范围：0.0-1.0（1.0表示每个参赛人员都获得奖牌）

---

## 三、数据质量检查

### 3.1 数据验证

✓ **2024年数据验证**（与赛题一致）：
```
中国：40枚金牌，91枚总奖牌，258名运动员 ✓
美国：40枚金牌，126枚总奖牌，319名运动员 ✓
法国：16枚金牌，64枚总奖牌，250名运动员（主办国）✓
```

### 3.2 缺失值处理

| 特征 | 缺失值数 | 缺失率 | 处理方式 |
|------|--------|--------|--------|
| Lag_1_Gold/Total | 214 | 2.5% | 保留NaN（首次参赛） |
| Lag_2_Gold/Total | 428 | 5.0% | 保留NaN |
| Lag_3_Gold/Total | 642 | 7.5% | 保留NaN |
| Athlete_Count等 | 0 | 0% | 填充为0 |
| Avg_Sport_Efficiency | 0 | 0% | 填充为0 |

### 3.3 数据统计摘要

```
Gold_Medals:     mean=0.22,  std=1.60, min=0, max=60
Total_Medals:    mean=0.67,  std=4.72, min=0, max=166
Athlete_Count:   mean=17.09, std=39.26, min=0, max=321
Avg_Sport_Efficiency: mean=0.083, range=[0, 1.0]
```

---

## 四、后续建模建议

### 4.1 数据分割

```
Training Set:   1896-2020 (30届)
Validation Set: 2024 (验证集)
Test Set:       2028 (预测目标)
```

### 4.2 推荐的模型方法

1. **时间序列回归**（ARIMA, Exponential Smoothing）
   - 利用Lag特征的强预测能力
   - 捕捉国家奖牌数的长期趋势

2. **计数数据模型**（Poisson / Negative Binomial Regression）
   - 奖牌数是非负的整数
   - 解决普通线性回归可能出现负数预测的问题

3. **机器学习**（Random Forest, XGBoost）
   - 捕捉非线性关系
   - 自动交互项（例如：Is_Host × Avg_3yr_Gold）
   - 特征重要性分析

4. **分层预测**
   - 对参赛国和未参赛国分别建模
   - 使用逻辑回归预测"首枚奖牌概率"

### 4.3 特征工程的后续方向

- **项目强势度特征**：计算国家在历史优势项目的相对地位
- **女性支持特征**：女性运动员比例与女性项目数量的交互
- **变化率特征**：Lag特征的一阶差分（趋势加速/减速）
- **竞争强度特征**：参赛国数量的变化（新国家进入）

---

## 五、输出文件说明

### 5.1 生成的数据文件

| 文件名 | 记录数 | 用途 |
|--------|--------|------|
| `summerOly_athletes_cleaned.csv` | 113,342 | 清洗后的运动员数据 |
| `summerOly_medal_counts_cleaned.csv` | 1,434 | 清洗后的奖牌统计 |
| `summerOly_hosts_cleaned.csv` | 35 | 主办国信息 |
| `summerOly_programs_cleaned.csv` | 74 | 项目信息 |
| `country_year_features.csv` | 8,618 | **最终特征数据集** |

### 5.2 特征列完整列表

```python
['NOC', 'Year',  # 标识符
 'Gold_Medals', 'Silver_Medals', 'Bronze_Medals', 'Total_Medals',  # 目标变量
 'Lag_1_Gold', 'Lag_2_Gold', 'Lag_3_Gold',  # 历史金牌
 'Lag_1_Total', 'Lag_2_Total', 'Lag_3_Total',  # 历史总奖牌
 'Avg_3yr_Gold', 'Avg_3yr_Total',  # 移动平均
 'Is_Host',  # 东道主效应
 'Athlete_Count', 'Female_Athletes', 'Female_Ratio',  # 运动员特征
 'Sport_Count', 'Event_Count',  # 项目覆盖度
 'Total_Gold_in_Olympics',  # 全局奥运特征
 'Avg_Sport_Efficiency']  # 项目效率
```

---

## 六、关键假设与局限

### 6.1 关键假设

1. **国家名称映射**：通过Team-NOC对应关系进行映射，109条奖牌记录可能映射不准确
2. **主办国效应**：使用固定的主办国列表，假设对应关系准确
3. **去重策略**：假设同一Event的多个队员获得相同奖牌类型时只计一次
4. **缺失值处理**：对未参赛国采用填充为0的策略

### 6.2 数据限制

- 某些早期奥运会（1906年插值奥运）的数据可能不完整
- 1980年莫斯科奥运会因政治抵制参加国数量异常
- 未能完全映射的109条奖牌记录可能影响某些国家的历史统计

---

## 七、使用示例

```python
import pandas as pd

# 读取特征数据集
df = pd.read_csv('country_year_features.csv')

# 查看中国的历史数据
china_history = df[df['NOC'] == 'CHN']

# 查看2024年的前10名国家
top_10_2024 = df[df['Year'] == 2024].nlargest(10, 'Total_Medals')

# 分析东道主效应
host_effect = df[df['Is_Host'] == 1].groupby('Year')['Total_Medals'].mean()

# 准备训练数据（移除缺失值的Lag特征）
train_df = df[(df['Year'] <= 2020) & (df['Lag_1_Total'].notna())].copy()
test_df = df[df['Year'] == 2024].copy()
```

---

**数据处理完成时间**：2026年1月21日  
**下一步**：进行特征选择和模型建立

